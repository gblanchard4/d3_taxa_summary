<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

rect:hover {
				fill: orange;
			}

#tooltip {
	position: absolute;
	width: 200px;
	height: auto;
	padding: 10px;
	background-color: white;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	border-radius: 10px;
	-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
	pointer-events: none;
}

#tooltip.hidden {
	display: none;
}

#tooltip p {
	margin: 0;
	font-family: sans-serif;
	font-size: 16px;
	line-height: 20px;
}

</style>
<body>

    <div id="l1">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l2">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l3">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l4">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l5">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l6">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>
    <div id="l7">
        <div id="tooltip" class="hidden">
			<p><strong>Important Label Heading</strong></p>
			<p><span id="value">100</span>%</p>
		</div>
    </div>

<script src="d3.js"></script>
<script>
    function graph_taxa(file_string, level) {
        d3.csv(file_string, function(error, data) {
            if (error) throw error;
            var margin = {top: 20, right: 20, bottom: 30, left: 40},
            w = 960 - margin.left - margin.right,
            h = 500 - margin.top - margin.bottom;

            var xScale = d3.scale.ordinal()
            .rangeRoundBands([0, w], .1);

            var yScale = d3.scale.linear()
            .rangeRound([h, 0]);

            var color = d3.scale.category20b();

            var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("bottom");

            var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left")
            // .tickFormat(d3.format(".2s"));

            var svg = d3.select(level).append("svg")
            .attr("width", w + margin.left + margin.right)
            .attr("height", h + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            color.domain(d3.keys(data[0]).filter(function(key) { return key !== "SampleID"; }));

            data.forEach(function(d) {
                var y0 = 0;
                d.taxa = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
                d.total = d.taxa[d.taxa.length - 1].y1;
            });

            data.sort(function(a, b) { return b.total - a.total; });

            xScale.domain(data.map(function(d) { return d.SampleID; }));
            yScale.domain([0, d3.max(data, function(d) { return d.total; })]);

            svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + h + ")")
            .call(xAxis);

            svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Abundance");

            var sample = svg.selectAll(".sample")
            .data(data)
            .enter().append("g")
            .attr("class", "g")
            .attr("transform", function(d) { return "translate(" + xScale(d.SampleID) + ",0)"; });

            sample.selectAll("rect")
            .data(function(d) { return d.taxa; })
            .enter().append("rect")
            .attr("width", xScale.rangeBand())
            .attr("y", function(d) { return yScale(d.y1); })
            .attr("height", function(d) { return yScale(d.y0) - yScale(d.y1); })
            .style("fill", function(d) { return color(d.name); });


            var legend = svg.selectAll(".legend")
            .data(color.domain().slice().reverse())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            // legend.append("rect")
            //     .attr("x", width)
            //     .attr("width", 18)
            //     .attr("height", 18)
            //     .style("fill", color);
            //
            // legend.append("text")
            //     .attr("x", width)
            //     .attr("y", 9)
            //     .attr("dy", ".35em")
            //     .style("text-anchor", "end")
            //     .text(function(d) { return d; });

        });
}

graph_taxa("wat/1.txt",l1)
graph_taxa("wat/2.txt",l2)
graph_taxa("wat/3.txt",l3)
graph_taxa("wat/4.txt",l4)
graph_taxa("wat/5.txt",l5)
graph_taxa("wat/6.txt",l6)
graph_taxa("wat/7.txt",l7)



</script>
